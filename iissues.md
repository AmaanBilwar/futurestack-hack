fix middleware issue and  protected routes


